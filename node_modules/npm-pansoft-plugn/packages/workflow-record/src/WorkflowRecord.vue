<template>
    <TimeLine v-if="dialogVisible" :title="timeLine.title" :dialogShow.sync="dialogVisible" :activities="activities" :onClose="distroy"></TimeLine>
</template>

<script>
export default {
    name:"WorkflowRecord",
    components: {
    },data(){
        return{
            dialogVisible:this.dialogShow,
            nodeParms:{
                workId:this.workId,
                tenantCode:this.tenantCode
            },
            flowInfo:[],
            timeLine:{
                title:this.title
            }
        }
    },
    created(){
       this.getNodeList();
    },
    mounted(){
    },
    computed:{
        activities(){
            let ret=[];
            if(this.flowInfo.length>0){
                for(var key in this.flowInfo){
                    let temp={};
                    temp.content="<h style='color:red'>"+this.flowInfo[key].userName+"</h> 在 <h style='color:#409eff'>"+this.flowInfo[key].nodeName+"</h> 节点进行了 <h style='color:#69aa46'>"+this.flowInfo[key].actionname +"</h> 操作，操作内容："+this.flowInfo[key].memo+
                                "</br> <a class='el-icon-chat-line-square'></a> 意见: "+this.flowInfo[key].comments;
                    temp.timestamp=this.flowInfo[key].actiontime;
                    temp.size= 'large';
                    temp.type= 'primary';
                    temp.icon= 'el-icon-more';
                    ret.push(temp);
                }
            }
            return ret;
        }
    },
    watch:{
        dialogShow () {
            //此处是关键
            this.dialogVisible = this.dialogShow;
        }
    },
    props:{
        dialogShow:{
            type:Boolean,
            default:false,
        },
        canelBtText:{
            type:String,
            default:"取 消"
        },
        workId:{
            type:String,
            default:""
        },
        tenantCode:{
            type:String,
            default:"system"
        },
        title:{
            type:String,
            default:"审核记录"
        },
        width:{
            type:String,
            default:"520px"
        },
        height:{
            type:String,
            default:"400px"
        },
        onOk:{
            type:Function,
            default:()=>{}
        },
        dialogCenter:{
            type:Boolean,
            default:true,
        },
        params:{
            type:Object,
            default:()=>{}
        }
    },
    methods:{
        getNodeList(){
            let that = this;
            this.axios.apiPost({
                url:"/hzworkflow/getFlowInfo",
                data:this.nodeParms,
                call:function(res){
                    // console.log(res);
                    if(res.data.flag){
                        that.flowInfo=res.data.flowInfo;
                    }
                }
            });
        },
        distroy(){
            this.$emit('update:dialogShow', false);
        }
    }
}
</script>